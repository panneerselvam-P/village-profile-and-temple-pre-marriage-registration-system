<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temple Admin ¬∑ Marriage Registration Management</title>
    <!-- Font Awesome 6 (free) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Font: Inter clean -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f3f7fc;
            color: #1e293b;
            line-height: 1.5;
            padding: 30px 24px;
        }

        .admin-wrapper {
            max-width: 1440px;
            margin: 0 auto;
        }

        /* header like temple style */
        .admin-header {
            background: linear-gradient(145deg, #000080, #1e3a8a);
            padding: 22px 32px;
            border-radius: 24px 24px 24px 24px;
            color: white;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 12px 28px rgba(0, 0, 128, 0.2);
            border-bottom: 6px solid #ffd700;
            margin-bottom: 32px;
        }

        .temple-badge h1 {
            font-size: 1.9rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .temple-badge h1 i {
            color: #ffd700;
            font-size: 2.2rem;
        }

        .temple-badge span {
            display: block;
            font-size: 0.9rem;
            color: #cbd5e1;
            margin-top: 6px;
        }

        .admin-profile {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 24px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            gap: 14px;
            backdrop-filter: blur(4px);
            border: 1px solid #b0c4de;
        }

        .stats-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 22px 28px;
            border-radius: 20px;
            flex: 1 1 180px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.03);
            border-left: 8px solid #000080;
            display: flex;
            align-items: center;
            gap: 18px;
            transition: all 0.2s;
        }

        .stat-card i {
            font-size: 2.5rem;
            color: #4169e1;
        }

        .stat-info h3 {
            font-size: 1.9rem;
            font-weight: 700;
            color: #0f172a;
        }

        .stat-info p {
            color: #475569;
            font-weight: 500;
        }

        /* action toolbar */
        .action-toolbar {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            background: white;
            padding: 18px 26px;
            border-radius: 18px;
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.02);
        }

        .search-sort {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #f1f5f9;
            border-radius: 40px;
            padding: 6px 16px;
            gap: 12px;
        }

        .search-box i {
            color: #64748b;
        }

        .search-box input {
            border: none;
            background: transparent;
            padding: 10px 0;
            width: 240px;
            font-size: 0.95rem;
            outline: none;
        }

        .sort-dropdown {
            background: #f1f5f9;
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: 500;
            color: #1e293b;
            cursor: pointer;
            outline: none;
        }

        .btn {
            border: none;
            padding: 12px 26px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: white;
            color: #1e293b;
            transition: 0.15s;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.02);
            border: 1px solid #e2e8f0;
        }

        .btn-primary {
            background: #000080;
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: #1e3a8a;
        }

        .btn-success {
            background: #0b5e42;
            color: white;
            border: none;
        }

        .btn-outline {
            border: 1.5px solid #000080;
            background: white;
            color: #000080;
        }

        /* table card */
        .table-container {
            background: white;
            border-radius: 24px;
            padding: 8px 8px 8px 8px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.04);
            overflow-x: auto;
            margin-bottom: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            text-align: left;
            padding: 20px 16px;
            background: #f8fafc;
            color: #1e293b;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 18px 16px;
            border-bottom: 1px solid #eef2f6;
            vertical-align: middle;
        }

        tr:hover {
            background: #f9fcff;
        }

        .badge {
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge.approved {
            background: #dff0e6;
            color: #0b5e42;
        }

        .badge.pending {
            background: #fff4e5;
            color: #b45b0f;
        }

        .badge.rejected {
            background: #fee9e7;
            color: #a12b1d;
        }

        .action-icons {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
        }

        .action-icons i {
            font-size: 1.2rem;
            cursor: pointer;
            color: #475569;
            transition: 0.1s;
        }

        .action-icons .fa-check-circle:hover {
            color: #15803d;
        }

        .action-icons .fa-pen-to-square:hover {
            color: #1e3a8a;
        }

        .action-icons .fa-trash-can:hover {
            color: #b91c1c;
        }

        .action-icons .fa-download:hover {
            color: #6b21a8;
        }

        /* modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(3px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-card {
            background: white;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 32px;
            padding: 30px 32px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
            animation: fadeSlide 0.2s ease;
        }

        .modal-section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e3a8a;
            margin: 24px 0 12px 0;
            padding-bottom: 6px;
            border-bottom: 2px solid #eef2f6;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes fadeSlide {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid #ffd700;
        }

        .modal-header h2 {
            font-size: 1.7rem;
            color: #000080;
        }

        .close-modal {
            font-size: 1.8rem;
            cursor: pointer;
            color: #64748b;
        }

        .modal-form .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }

        .modal-form .form-group {
            flex: 1 1 200px;
        }

        .modal-form label {
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
            color: #1e293b;
            font-size: 0.9rem;
        }

        .modal-form input,
        .modal-form select {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid #e2e8f0;
            border-radius: 14px;
            font-size: 0.95rem;
            outline: none;
            transition: 0.1s;
        }

        .modal-form input:focus,
        .modal-form select:focus {
            border-color: #000080;
            box-shadow: 0 0 0 3px rgba(0, 0, 128, 0.08);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 28px;
        }

        .certificate-preview {
            background: #f1f5f9;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #000080;
            font-family: 'Times New Roman', serif;
        }

        .download-link {
            background: #000080;
            color: white;
            padding: 12px 20px;
            border-radius: 40px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .footer-note {
            text-align: center;
            color: #5a6a7a;
            margin-top: 40px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <div class="admin-wrapper">
        <!-- ADMIN HEADER with temple identity -->
        <div class="admin-header">
            <div class="temple-badge">
                <h1><i class="fas fa-ring"></i> ‡ÆÖ‡Æ∞‡ØÅ‡Æ≥‡Øç‡ÆÆ‡Æø‡Æï‡ØÅ ‡Æ∏‡Øç‡Æ∞‡ØÄ ‡ÆÖ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ®‡Ææ‡Æ∞‡ØÄ‡Æ∏‡Øç‡Æµ‡Æ∞‡Æ∞‡Øç</h1>
                <span>Arulmigu Sri Arthanaareeswarar Temple ¬∑ Ulagiyanallur</span>
                <span style="font-size:0.9rem; color:#ffd700;"><i class="fas fa-shield-alt"></i> Marriage Registration
                    Admin</span>
            </div>
            <div class="admin-profile">
                <i class="fas fa-user-tie" style="font-size:1.6rem;"></i>
                <div>
                    <strong>Admin Officer</strong>
                    <p style="font-size:0.8rem;">Temple Registrar</p>
                </div>
            </div>
        </div>

        <!-- STATISTICS CARDS (dynamic counts via JS) -->
        <div class="stats-cards">
            <div class="stat-card">
                <i class="fas fa-file-signature"></i>
                <div class="stat-info">
                    <h3 id="total-reg-count">24</h3>
                    <p>Total Registrations</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-hourglass-half"></i>
                <div class="stat-info">
                    <h3 id="pending-count">8</h3>
                    <p>Pending Approval</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-check-circle"></i>
                <div class="stat-info">
                    <h3 id="approved-count">14</h3>
                    <p>Approved</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-download"></i>
                <div class="stat-info">
                    <h3 id="certs-dl">36</h3>
                    <p>Certificates issued</p>
                </div>
            </div>
        </div>

        <!-- TOOLBAR : SEARCH, SORT, FILTER + ADD MOCK (crud) -->
        <div class="action-toolbar">
            <div class="search-sort">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search by name, ID, aadhar..."
                        onkeyup="filterTable()">
                </div>
                <select id="sortSelect" class="sort-dropdown" onchange="sortRegistrations()">
                    <option value="default">Sort by: Newest</option>
                    <option value="nameAsc">Name (A-Z)</option>
                    <option value="nameDesc">Name (Z-A)</option>
                    <option value="dateAsc">Marriage date (oldest)</option>
                    <option value="dateDesc">Marriage date (latest)</option>
                    <option value="status">Status (pending first)</option>
                </select>
                <select id="filterStatus" class="sort-dropdown" onchange="filterByStatus()">
                    <option value="all">All status</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="openAddRegistrationModal()"><i class="fas fa-plus-circle"></i> New
                Registration</button>
        </div>

        <!-- REGISTRATION TABLE : dynamic from javascript array -->
        <div class="table-container">
            <table id="registrationTable">
                <thead>
                    <tr>
                        <th>App. No</th>
                        <th>Bride / Groom</th>
                        <th>Marriage Date</th>
                        <th>Marriage Time</th>
                        <th>Status</th>
                        <th>Print Certificate</th>
                        <th>Actions (CRUD + Approve)</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- javascript dynamic rows -->
                </tbody>
            </table>
            <div id="noResults" style="display:none; text-align:center; padding:40px; color:#64748b;">No registrations
                found.</div>
        </div>

        <!-- FOOTER INFO -->
        <div class="footer-note">
            <p>Arulmigu Sri Arthanaareeswarar Temple ¬∑ Official Marriage Register ¬∑ All data encrypted</p>
            <p style="margin-top: 6px;">üìú Admin can approve, edit, delete, download certificate ‚Äì full CRUD operation
            </p>
        </div>
    </div>

    <!-- ========== MODAL: EDIT / VIEW / APPROVE (dynamic) ========== -->
    <div id="editModal" class="modal">
        <div class="modal-card">
            <div class="modal-header">
                <h2 id="modalTitle"><i class="fas fa-pen"></i> Edit Registration</h2>
                <span class="close-modal" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-form" id="editFormContent">
                <!-- dynamic fields from JS -->
            </div>
        </div>
    </div>

    <!-- MODAL: CERTIFICATE DOWNLOAD / PREVIEW -->
    <div id="certificateModal" class="modal">
        <div class="modal-card" style="max-width:700px;">
            <div class="modal-header">
                <h2><i class="fas fa-certificate"></i> Marriage Certificate</h2>
                <span class="close-modal" onclick="closeCertModal()">&times;</span>
            </div>
            <div id="certificateContent" class="certificate-preview">
                <!-- dynamic certificate preview from certificate.html style -->
            </div>
            <div style="display:flex; justify-content:flex-end; gap:16px;">
                <button class="btn btn-outline" onclick="closeCertModal()"><i class="fas fa-times"></i> Close</button>
                <a id="downloadCertBtn" class="download-link" download="marriage_certificate.pdf" href="#"><i
                        class="fas fa-download"></i> Download PDF</a>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let registrations = [];
        let currentFiltered = [];

        async function fetchRegistrations() {
            try {
                const response = await fetch(`${API_BASE}/registrations`);
                const result = await response.json();
                if (result.success) {
                    registrations = result.data;
                    currentFiltered = registrations.slice();
                    loadTable(registrations);
                } else {
                    console.error('Failed to fetch:', result.message);
                }
            } catch (error) {
                console.error('API Error:', error);
            }
        }

        // ---------- helper functions (CRUD, render, sort, filter) ----------
        function loadTable(dataArray) {
            const tbody = document.getElementById('tableBody');
            const noResults = document.getElementById('noResults');
            if (!tbody) return;
            if (dataArray.length === 0) {
                tbody.innerHTML = '';
                noResults.style.display = 'block';
                updateStats();
                return;
            } else noResults.style.display = 'none';

            let html = '';
            dataArray.forEach(reg => {
                const status = (reg.paymentStatus || 'pending').toLowerCase();
                const statusClass = status === 'success' || status === 'approved' ? 'approved' : (status === 'pending' ? 'pending' : 'rejected');
                const brideFull = reg.brideName + ' ' + (reg.brideInitial || '');
                const groomFull = reg.groomName + ' ' + (reg.groomInitial || '');
                html += `<tr>
                    <td><strong>${reg.applicationNumber || ('MR-' + reg.id)}</strong></td>
                    <td>üë∞ ${brideFull}<br>ü§µ ${groomFull}</td>
                    <td>${formatDate(reg.marriageDate)}</td>
                    <td>${formatTime(reg.marriageTime)}</td>
                    <td><span class="badge ${statusClass}">${status.toUpperCase()}</span></td>
                    <td>
                        <button class="btn" style="padding:8px 16px;" onclick="generateCertificate('${reg.id}')"><i class="fas fa-certificate"></i> Generate</button>
                    </td>
                    <td>
                        <div class="action-icons">
                            <i class="fas fa-check-circle" title="Approve Registration" onclick="approveRegistration('${reg.id}')"></i>
                            <i class="fas fa-pen-to-square" title="Edit Full Record" onclick="openEditModal('${reg.id}')"></i>
                            <i class="fas fa-trash-can" title="Delete" onclick="deleteRegistration('${reg.id}')"></i>
                            <i class="fas fa-print" title="Print Certificate" onclick="generateCertificate('${reg.id}')"></i>
                        </div>
                    </td>
                </tr>`;
            });
            tbody.innerHTML = html;
            updateStats();
        }

        // format date
        function formatDate(dateStr) {
            if (!dateStr) return '‚Äî';
            const d = new Date(dateStr + 'T12:00:00');
            return d.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
        }

        function formatTime(timeStr) {
            if (!timeStr) return '‚Äî';
            try {
                const [hours, minutes] = timeStr.split(':');
                let h = parseInt(hours, 10);
                const ampm = h >= 12 ? 'PM' : 'AM';
                h = h % 12;
                h = h ? h : 12;
                return `${h}:${minutes} ${ampm}`;
            } catch (e) {
                return timeStr;
            }
        }

        // statistics
        function updateStats() {
            const total = registrations.length;
            const pending = registrations.filter(r => (r.paymentStatus || 'pending').toLowerCase() === 'pending').length;
            const approved = registrations.filter(r => ['success', 'approved'].includes((r.paymentStatus || '').toLowerCase())).length;
            const certCount = approved;
            document.getElementById('total-reg-count').innerText = total;
            document.getElementById('pending-count').innerText = pending;
            document.getElementById('approved-count').innerText = approved;
            document.getElementById('certs-dl').innerText = certCount;
        }

        // filter + search
        function filterTable() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = registrations.filter(r =>
                String(r.id).includes(query) ||
                (r.applicationNumber && r.applicationNumber.toLowerCase().includes(query)) ||
                (r.brideName && r.brideName.toLowerCase().includes(query)) ||
                (r.groomName && r.groomName.toLowerCase().includes(query)) ||
                (r.brideAadhar && r.brideAadhar.includes(query)) ||
                (r.groomAadhar && r.groomAadhar.includes(query))
            );
            applyStatusFilter(filtered);
        }



        function filterByStatus() {
            const filterVal = document.getElementById('filterStatus').value;
            let filtered = registrations.filter(r => {
                const status = (r.paymentStatus || 'pending').toLowerCase();
                if (filterVal === 'all') return true;
                if (filterVal === 'approved') return status === 'success' || status === 'approved';
                return status === filterVal;
            });
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query) filtered = filtered.filter(r =>
                String(r.id).includes(query) ||
                (r.applicationNumber && r.applicationNumber.toLowerCase().includes(query)) ||
                (r.brideName && r.brideName.toLowerCase().includes(query))
            );
            currentFiltered = filtered.slice();
            sortAndRender(filtered);
        }

        function sortRegistrations() {
            const sortVal = document.getElementById('sortSelect').value;
            let toSort = currentFiltered.length ? currentFiltered : registrations.slice();
            if (sortVal === 'nameAsc') toSort.sort((a, b) => (a.brideName + a.groomName).localeCompare(b.brideName + b.groomName));
            if (sortVal === 'nameDesc') toSort.sort((a, b) => (b.brideName + b.groomName).localeCompare(a.brideName + a.groomName));
            if (sortVal === 'dateAsc') toSort.sort((a, b) => new Date(a.marriageDate) - new Date(b.marriageDate));
            if (sortVal === 'dateDesc') toSort.sort((a, b) => new Date(b.marriageDate) - new Date(a.marriageDate));
            if (sortVal === 'status') toSort.sort((a, b) => (a.status === 'pending' ? -1 : 1));
            loadTable(toSort);
        }

        function sortAndRender(arr) {
            const sortVal = document.getElementById('sortSelect').value;
            if (sortVal === 'nameAsc') arr.sort((a, b) => (a.brideName + a.groomName).localeCompare(b.brideName + b.groomName));
            if (sortVal === 'nameDesc') arr.sort((a, b) => (b.brideName + b.groomName).localeCompare(a.brideName + a.groomName));
            if (sortVal === 'dateAsc') arr.sort((a, b) => new Date(a.marriageDate) - new Date(b.marriageDate));
            if (sortVal === 'dateDesc') arr.sort((a, b) => new Date(b.marriageDate) - new Date(a.marriageDate));
            if (sortVal === 'status') arr.sort((a, b) => (a.status === 'pending' ? -1 : 1));
            loadTable(arr);
        }

        function applyStatusFilter(baseArr) {
            const filterVal = document.getElementById('filterStatus').value;
            let filtered = baseArr;
            if (filterVal !== 'all') {
                filtered = baseArr.filter(r => {
                    const status = (r.paymentStatus || 'pending').toLowerCase();
                    if (filterVal === 'approved') return status === 'success' || status === 'approved';
                    return status === filterVal;
                });
            }
            currentFiltered = filtered.slice();
            sortAndRender(filtered);
        }

        // ---------- CRUD + APPROVE ----------
        async function approveRegistration(id) {
            if (!confirm(`Approve registration MR-${id}?`)) return;
            try {
                const response = await fetch(`${API_BASE}/registrations/${id}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: 'SUCCESS' })
                });
                const result = await response.json();
                if (result.success) {
                    alert(`‚úÖ Registration MR-${id} approved.`);
                    fetchRegistrations();
                } else alert('Error: ' + result.message);
            } catch (err) { console.error(err); }
        }

        async function deleteRegistration(id) {
            if (!confirm(`Are you sure you want to PERMANENTLY delete registration MR-${id}?`)) return;
            try {
                const response = await fetch(`${API_BASE}/registrations/${id}`, { method: 'DELETE' });
                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Registration deleted.');
                    fetchRegistrations();
                } else alert('Error: ' + result.message);
            } catch (err) { console.error(err); }
        }

        // open edit modal with data
        function openEditModal(id) {
            const reg = registrations.find(r => String(r.id) === String(id));
            if (!reg) return;
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit"></i> Full Record Access';
            let html = `<form id="editForm" onsubmit="saveEditRegistration('${id}'); return false;">`;

            html += `<div class="modal-section-title"><i class="fas fa-file-invoice"></i> Link Details</div>`;
            html += `<div class="form-row">
                <div class="form-group"><label>Application Number (from User)</label><input type="text" id="edit_applicationNumber" value="${reg.applicationNumber || ''}" placeholder="e.g. TN12345M2"></div>
            </div>`;
            html += `<div class="modal-section-title"><i class="fas fa-user"></i> Bride & Groom Details</div>`;
            html += `<div class="form-row">
                <div class="form-group"><label>Bride Name</label><input type="text" id="edit_brideName" value="${reg.brideName || ''}" required></div>
                <div class="form-group"><label>Bride Initial</label><input type="text" id="edit_brideInitial" value="${reg.brideInitial || ''}"></div>
                <div class="form-group"><label>Bride Aadhar</label><input type="text" id="edit_brideAadhar" value="${reg.brideAadhar || ''}"></div>
            </div>`;
            html += `<div class="form-row">
                <div class="form-group"><label>Groom Name</label><input type="text" id="edit_groomName" value="${reg.groomName || ''}" required></div>
                <div class="form-group"><label>Groom Initial</label><input type="text" id="edit_groomInitial" value="${reg.groomInitial || ''}"></div>
                <div class="form-group"><label>Groom Aadhar</label><input type="text" id="edit_groomAadhar" value="${reg.groomAadhar || ''}"></div>
            </div>`;

            html += `<div class="modal-section-title"><i class="fas fa-users"></i> Parents Details</div>`;
            html += `<div class="form-row">
                <div class="form-group"><label>Bride Father</label><input type="text" id="edit_brideFatherName" value="${reg.brideFatherName || ''}"></div>
                <div class="form-group"><label>Bride Mother</label><input type="text" id="edit_brideMotherName" value="${reg.brideMotherName || ''}"></div>
            </div>`;
            html += `<div class="form-row">
                <div class="form-group"><label>Groom Father</label><input type="text" id="edit_groomFatherName" value="${reg.groomFatherName || ''}"></div>
                <div class="form-group"><label>Groom Mother</label><input type="text" id="edit_groomMotherName" value="${reg.groomMotherName || ''}"></div>
            </div>`;

            html += `<div class="modal-section-title"><i class="fas fa-calendar-alt"></i> Marriage & Status</div>`;
            html += `<div class="form-row">
                <div class="form-group"><label>Marriage Date</label><input type="date" id="edit_marriageDate" value="${reg.marriageDate || ''}"></div>
                <div class="form-group"><label>Marriage Time</label><input type="time" id="edit_marriageTime" value="${reg.marriageTime || ''}"></div>
                <div class="form-group"><label>Status</label>
                    <select id="edit_paymentStatus">
                        <option value="PENDING" ${reg.paymentStatus === 'PENDING' ? 'selected' : ''}>PENDING</option>
                        <option value="SUCCESS" ${['SUCCESS', 'approved'].includes(reg.paymentStatus) ? 'selected' : ''}>SUCCESS (Approved)</option>
                        <option value="REJECTED" ${reg.paymentStatus === 'REJECTED' ? 'selected' : ''}>REJECTED</option>
                    </select>
                </div>
            </div>`;
            html += `<div class="form-row"><div class="form-group"><label>Reception Place</label><input type="text" id="edit_receptionPlace" value="${reg.receptionPlace || ''}"></div></div>`;

            html += `<div class="modal-actions">
                <button type="button" class="btn btn-outline" onclick="closeEditModal()">Cancel</button>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save All Changes</button>
            </div>`;
            html += `</form>`;
            document.getElementById('editFormContent').innerHTML = html;
            document.getElementById('editModal').style.display = 'flex';
        }

        async function saveEditRegistration(id) {
            const reg = registrations.find(r => String(r.id) === String(id));
            if (!reg) return;

            const updatedData = {
                ...reg,
                applicationNumber: document.getElementById('edit_applicationNumber').value,
                brideName: document.getElementById('edit_brideName').value,
                brideInitial: document.getElementById('edit_brideInitial').value,
                brideAadhar: document.getElementById('edit_brideAadhar').value,
                groomName: document.getElementById('edit_groomName').value,
                groomInitial: document.getElementById('edit_groomInitial').value,
                groomAadhar: document.getElementById('edit_groomAadhar').value,
                brideFatherName: document.getElementById('edit_brideFatherName').value,
                brideMotherName: document.getElementById('edit_brideMotherName').value,
                groomFatherName: document.getElementById('edit_groomFatherName').value,
                groomMotherName: document.getElementById('edit_groomMotherName').value,
                marriageDate: document.getElementById('edit_marriageDate').value,
                marriageTime: document.getElementById('edit_marriageTime').value,
                paymentStatus: document.getElementById('edit_paymentStatus').value,
                receptionPlace: document.getElementById('edit_receptionPlace').value
            };

            try {
                const response = await fetch(`${API_BASE}/registrations/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });
                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Full record updated successfully.');
                    closeEditModal();
                    fetchRegistrations();
                } else alert('Update failed: ' + result.message);
            } catch (err) { console.error(err); }
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function openAddRegistrationModal() {
            alert('As an Admin, if you want to create a new registration, click OK to be redirected.');
            window.location.href = 'signup.html';
        }

        // ---------- CERTIFICATE MODAL based on certificate.html style ----------
        // ---------- CERTIFICATE GENERATION ----------
        function generateCertificate(id) {
            const reg = registrations.find(r => String(r.id) === String(id));
            if (!reg) return;
            const status = (reg.paymentStatus || '').toLowerCase();
            if (status !== 'success' && status !== 'approved') {
                if (!confirm('This registration is not yet approved/paid. Generate certificate anyway?')) return;
            }
            window.open(`certificate.html?id=${id}`, '_blank');
        }

        // Old modal functions removed for direct page usage
        function closeCertModal() {
            document.getElementById('certificateModal').style.display = 'none';
        }

        // close modal when click outside? optional
        window.onclick = function (e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        }

        // initial load
        window.onload = function () {
            fetchRegistrations();
        }
    </script>
</body>

</html>