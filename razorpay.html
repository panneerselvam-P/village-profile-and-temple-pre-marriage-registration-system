<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Razorpay Payment Gateway</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo-icon {
            color: #0f172a;
            font-size: 32px;
        }

        .logo-text {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
        }

        .tagline {
            color: #64748b;
            font-weight: 500;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }

        .order-summary {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .order-summary h2 {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
            color: #0f172a;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .order-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #0f172a;
        }

        .payment-section {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .payment-header {
            margin-bottom: 25px;
        }

        .payment-header h2 {
            color: #0f172a;
            margin-bottom: 5px;
        }

        .payment-subtitle {
            color: #64748b;
            font-size: 0.95rem;
        }

        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 20px;
        }

        .payment-method {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .payment-method:hover {
            border-color: #3b82f6;
        }

        .payment-method.active {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .payment-method i {
            font-size: 24px;
            margin-bottom: 5px;
            color: #64748b;
        }

        .payment-method.active i {
            color: #3b82f6;
        }

        .payment-form {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #475569;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .card-details {
            display: flex;
            gap: 15px;
        }

        .card-details .form-group {
            flex: 1;
        }

        .pay-button {
            width: 100%;
            padding: 16px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }

        .pay-button:hover {
            background-color: #2563eb;
        }

        .pay-button:disabled {
            background-color: #94a3b8;
            cursor: not-allowed;
        }

        .upi-section,
        .netbanking-section,
        .wallet-section {
            display: none;
        }

        .upi-section.active,
        .netbanking-section.active,
        .wallet-section.active {
            display: block;
        }

        .upi-input-container {
            display: flex;
            gap: 10px;
        }

        .upi-input-container input {
            flex: 1;
        }

        .verify-button {
            padding: 12px 20px;
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .verify-button:hover {
            background-color: #059669;
        }

        .bank-list,
        .wallet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .bank-item,
        .wallet-item {
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bank-item:hover,
        .wallet-item:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .bank-logo,
        .wallet-logo {
            width: 40px;
            height: 40px;
            margin: 0 auto 8px;
            background-color: #f1f5f9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #475569;
        }

        .success-modal,
        .error-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalAppear 0.3s ease-out;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-icon {
            font-size: 60px;
            color: #10b981;
            margin-bottom: 20px;
        }

        .error-icon {
            font-size: 60px;
            color: #ef4444;
            margin-bottom: 20px;
        }

        .modal-content h3 {
            margin-bottom: 10px;
            color: #0f172a;
        }

        .modal-content p {
            margin-bottom: 25px;
            color: #64748b;
        }

        .modal-button {
            padding: 12px 30px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .modal-button:hover {
            background-color: #2563eb;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
        }

        .secure-payment {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                align-items: center;
            }

            .order-summary,
            .payment-section {
                width: 100%;
                max-width: 100%;
            }

            .card-details {
                flex-direction: column;
                gap: 20px;
            }
        }

        .error-message {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .input-error {
            border-color: #ef4444;
        }

        .powered-by {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 5px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #64748b;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-credit-card"></i></div>
                <div class="logo-text">Razorpay</div>
            </div>
            <p class="tagline">Secure Payment Gateway</p>
        </header>

        <div class="main-content">
            <!-- Order Summary Section -->
            <section class="order-summary">
                <h2>Order Summary</h2>

                <div class="order-item">
                    <span>Web Development Course</span>
                    <span>â‚¹1,499.00</span>
                </div>

                <div class="order-item">
                    <span>GST (18%)</span>
                    <span>â‚¹269.82</span>
                </div>

                <div class="order-item">
                    <span>Platform Fee</span>
                    <span>â‚¹59.00</span>
                </div>

                <div class="order-item">
                    <span>Discount</span>
                    <span style="color: #10b981;">-â‚¹200.00</span>
                </div>

                <div class="order-total">
                    <span>Total Amount</span>
                    <span>â‚¹1,627.82</span>
                </div>

                <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <p style="color: #64748b; font-size: 0.9rem;">
                        <i class="fas fa-lock" style="margin-right: 5px;"></i>
                        Your payment is secured with 128-bit SSL encryption
                    </p>
                </div>
            </section>

            <!-- Payment Section -->
            <section class="payment-section">
                <div class="payment-header">
                    <h2>Complete Your Payment</h2>
                    <p class="payment-subtitle">Choose your preferred payment method</p>
                </div>

                <!-- Payment Methods Tabs -->
                <div class="payment-methods">
                    <div class="payment-method active" data-method="card">
                        <i class="far fa-credit-card"></i>
                        <div>Card</div>
                    </div>
                    <div class="payment-method" data-method="upi">
                        <i class="fas fa-mobile-alt"></i>
                        <div>UPI</div>
                    </div>
                    <div class="payment-method" data-method="netbanking">
                        <i class="fas fa-university"></i>
                        <div>Net Banking</div>
                    </div>
                    <div class="payment-method" data-method="wallet">
                        <i class="fas fa-wallet"></i>
                        <div>Wallet</div>
                    </div>
                </div>

                <!-- Card Payment Form -->
                <div class="payment-form">
                    <div id="card-form" class="card-form active">
                        <div class="form-group">
                            <label class="form-label" for="card-number">Card Number</label>
                            <input type="text" id="card-number" class="form-input" placeholder="1234 5678 9012 3456"
                                maxlength="19">
                            <div class="error-message" id="card-number-error">Please enter a valid 16-digit card number
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="card-name">Name on Card</label>
                            <input type="text" id="card-name" class="form-input" placeholder="John Doe">
                            <div class="error-message" id="card-name-error">Please enter the name on your card</div>
                        </div>

                        <div class="card-details">
                            <div class="form-group">
                                <label class="form-label" for="expiry-date">Expiry Date</label>
                                <input type="text" id="expiry-date" class="form-input" placeholder="MM/YY">
                                <div class="error-message" id="expiry-error">Please enter a valid expiry date (MM/YY)
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="cvv">CVV</label>
                                <input type="password" id="cvv" class="form-input" placeholder="123" maxlength="4">
                                <div class="error-message" id="cvv-error">Please enter a valid CVV</div>
                            </div>
                        </div>
                    </div>

                    <!-- UPI Payment Form -->
                    <div id="upi-form" class="upi-section">
                        <div class="form-group">
                            <label class="form-label" for="upi-id">UPI ID</label>
                            <div class="upi-input-container">
                                <input type="text" id="upi-id" class="form-input" placeholder="username@upi">
                                <button class="verify-button" id="verify-upi">Verify</button>
                            </div>
                            <div class="error-message" id="upi-error">Please enter a valid UPI ID</div>
                        </div>

                        <p style="color: #64748b; font-size: 0.9rem; margin-top: 10px;">
                            <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                            You'll be redirected to your UPI app to complete the payment
                        </p>
                    </div>

                    <!-- Net Banking Form -->
                    <div id="netbanking-form" class="netbanking-section">
                        <div class="form-group">
                            <label class="form-label">Select Your Bank</label>
                            <div class="bank-list">
                                <div class="bank-item" data-bank="hdfc">
                                    <div class="bank-logo">HDFC</div>
                                    <div>HDFC Bank</div>
                                </div>
                                <div class="bank-item" data-bank="icici">
                                    <div class="bank-logo">ICICI</div>
                                    <div>ICICI Bank</div>
                                </div>
                                <div class="bank-item" data-bank="sbi">
                                    <div class="bank-logo">SBI</div>
                                    <div>State Bank</div>
                                </div>
                                <div class="bank-item" data-bank="axis">
                                    <div class="bank-logo">AXIS</div>
                                    <div>Axis Bank</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wallet Form -->
                    <div id="wallet-form" class="wallet-section">
                        <div class="form-group">
                            <label class="form-label">Select Wallet</label>
                            <div class="wallet-list">
                                <div class="wallet-item" data-wallet="paytm">
                                    <div class="wallet-logo">P</div>
                                    <div>Paytm</div>
                                </div>
                                <div class="wallet-item" data-wallet="phonepe">
                                    <div class="wallet-logo">PP</div>
                                    <div>PhonePe</div>
                                </div>
                                <div class="wallet-item" data-wallet="amazon">
                                    <div class="wallet-logo">A</div>
                                    <div>Amazon Pay</div>
                                </div>
                                <div class="wallet-item" data-wallet="gpay">
                                    <div class="wallet-logo">G</div>
                                    <div>Google Pay</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="pay-button" id="pay-now">
                        <span id="pay-button-text">Pay â‚¹1,627.82</span>
                        <i class="fas fa-lock" style="margin-left: 8px;"></i>
                    </button>

                    <div class="powered-by">
                        <span>Powered by</span>
                        <span style="font-weight: 600;">Razorpay</span>
                    </div>
                </div>
            </section>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="success-modal">
            <div class="modal-content">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Payment Successful!</h3>
                <p>Your payment of â‚¹1,627.82 has been completed successfully. A confirmation email has been sent to your
                    registered email address.</p>
                <p style="font-weight: 600; color: #0f172a;">Transaction ID: TXN-789456123</p>
                <button class="modal-button" id="success-ok" onclick="redirectToCertificate()">OK</button>
            </div>
        </div>

        <!-- Error Modal -->
        <div id="error-modal" class="error-modal">
            <div class="modal-content">
                <div class="error-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <h3>Payment Failed</h3>
                <p id="error-message-text">We encountered an issue while processing your payment. Please try again or
                    use a different payment method.</p>
                <button class="modal-button" id="error-ok">Try Again</button>
            </div>
        </div>

        <footer>
            <p>Â© 2023 Razorpay. All rights reserved.</p>
            <div class="secure-payment">
                <i class="fas fa-shield-alt"></i>
                <span>100% Secure Payments</span>
            </div>
        </footer>
    </div>

    <script>
        // DOM elements
        const paymentMethods = document.querySelectorAll('.payment-method');
        const cardForm = document.getElementById('card-form');
        const upiForm = document.getElementById('upi-form');
        const netbankingForm = document.getElementById('netbanking-form');
        const walletForm = document.getElementById('wallet-form');
        const payButton = document.getElementById('pay-now');
        const payButtonText = document.getElementById('pay-button-text');
        const successModal = document.getElementById('success-modal');
        const errorModal = document.getElementById('error-modal');
        const successOkButton = document.getElementById('success-ok');
        const errorOkButton = document.getElementById('error-ok');

        // Form input elements
        const cardNumberInput = document.getElementById('card-number');
        const cardNameInput = document.getElementById('card-name');
        const expiryInput = document.getElementById('expiry-date');
        const cvvInput = document.getElementById('cvv');
        const upiIdInput = document.getElementById('upi-id');
        const verifyUpiButton = document.getElementById('verify-upi');

        // Error message elements
        const cardNumberError = document.getElementById('card-number-error');
        const cardNameError = document.getElementById('card-name-error');
        const expiryError = document.getElementById('expiry-error');
        const cvvError = document.getElementById('cvv-error');
        const upiError = document.getElementById('upi-error');

        // Selected payment method
        let selectedMethod = 'card';
        let selectedBank = null;
        let selectedWallet = null;
        let upiVerified = false;

        // Initialize the payment gateway
        function initPaymentGateway() {
            // Check for Registration ID in URL
            const urlParams = new URLSearchParams(window.location.search);
            const registrationId = urlParams.get('id');
            const amount = urlParams.get('amount') || 500; // Default 500

            if (!registrationId) {
                // Optional: redirect if no ID, but for testing we might want to allow viewing
                console.warn('No registration ID found.');
            }

            // Update UI with amount
            const totalSpan = document.querySelector('.order-total span:last-child');
            if (totalSpan) totalSpan.textContent = 'â‚¹' + parseFloat(amount).toFixed(2);

            if (payButtonText) payButtonText.textContent = 'Pay â‚¹' + parseFloat(amount).toFixed(2);

            // Backend API Base URL
            const API_BASE_URL = 'http://localhost:8080/api';

            // Set up payment method selection
            paymentMethods.forEach(method => {
                method.addEventListener('click', () => {
                    // Remove active class from all methods
                    paymentMethods.forEach(m => m.classList.remove('active'));

                    // Add active class to clicked method
                    method.classList.add('active');

                    // Get the selected method
                    selectedMethod = method.getAttribute('data-method');

                    // Show the corresponding form
                    showPaymentForm(selectedMethod);

                    // Reset payment button text
                    payButtonText.textContent = `Pay â‚¹${parseFloat(amount).toFixed(2)}`;
                    payButton.disabled = false;
                });
            });

            // Set up bank and wallet listeners (kept from original)
            document.querySelectorAll('.bank-item').forEach(bank => {
                bank.addEventListener('click', () => {
                    document.querySelectorAll('.bank-item').forEach(b => {
                        b.style.borderColor = '#e2e8f0';
                        b.style.backgroundColor = 'white';
                    });
                    selectedBank = bank.getAttribute('data-bank');
                    bank.style.borderColor = '#3b82f6';
                    bank.style.backgroundColor = '#eff6ff';
                    payButton.disabled = false;
                });
            });

            document.querySelectorAll('.wallet-item').forEach(wallet => {
                wallet.addEventListener('click', () => {
                    document.querySelectorAll('.wallet-item').forEach(w => {
                        w.style.borderColor = '#e2e8f0';
                        w.style.backgroundColor = 'white';
                    });
                    selectedWallet = wallet.getAttribute('data-wallet');
                    wallet.style.borderColor = '#3b82f6';
                    wallet.style.backgroundColor = '#eff6ff';
                    payButton.disabled = false;
                });
            });

            // Set up UPI verification
            if (verifyUpiButton) {
                verifyUpiButton.addEventListener('click', () => {
                    const upiId = upiIdInput.value.trim();
                    if (!isValidUpiId(upiId)) {
                        showError(upiIdInput, upiError, 'Please enter a valid UPI ID');
                        upiVerified = false;
                        return;
                    }
                    verifyUpiButton.disabled = true;
                    verifyUpiButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    setTimeout(() => {
                        verifyUpiButton.disabled = false;
                        verifyUpiButton.textContent = 'Verified';
                        verifyUpiButton.style.backgroundColor = '#10b981';
                        upiVerified = true;
                        payButton.disabled = false;
                        upiError.style.display = 'none';
                        upiIdInput.classList.remove('input-error');
                    }, 1000);
                });
            }

            // Input formatting listeners
            if (cardNumberInput) cardNumberInput.addEventListener('input', formatCardNumber);
            if (expiryInput) expiryInput.addEventListener('input', formatExpiryDate);
            if (cardNumberInput) cardNumberInput.addEventListener('blur', validateCardNumber);
            if (cardNameInput) cardNameInput.addEventListener('blur', validateCardName);
            if (expiryInput) expiryInput.addEventListener('blur', validateExpiryDate);
            if (cvvInput) cvvInput.addEventListener('blur', validateCVV);

            // Override processPayment to use Razorpay
            if (payButton) {
                payButton.addEventListener('click', async function () {
                    try {
                        payButton.disabled = true;
                        payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                        // 1. Create Order on Backend
                        const orderResponse = await fetch(`${API_BASE_URL}/payment/create-order`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ amount: amount })
                        });

                        const orderData = await orderResponse.json();

                        if (!orderData.success) {
                            throw new Error(orderData.message);
                        }

                        // 2. Open Razorpay Checkout
                        const options = {
                            "key": "rzp_test_SDcDUX88PqzTjD", // Test Key
                            "amount": amount * 100, // Amount in paise
                            "currency": "INR",
                            "name": "Marriage Registration",
                            "description": "Registration Fee",
                            "image": "https://img.icons8.com/color/48/temple.png",
                            "order_id": orderData.orderId,
                            "handler": async function (response) {
                                // 3. Status Update on Backend
                                try {
                                    const updateResponse = await fetch(`${API_BASE_URL}/payment/success`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({
                                            registrationId: registrationId,
                                            paymentId: response.razorpay_payment_id,
                                            orderId: response.razorpay_order_id,
                                            signature: response.razorpay_signature
                                        })
                                    });

                                    const updateData = await updateResponse.json();
                                    if (updateData.success) {
                                        successModal.style.display = 'flex';
                                    } else {
                                        alert('Payment successful but failed to update status: ' + updateData.message);
                                    }
                                } catch (e) {
                                    console.error(e);
                                    alert('Error updating payment status');
                                }
                            },
                            "prefill": {
                                "name": "Applicant",
                                "email": "applicant@example.com",
                                "contact": "9999999999"
                            },
                            "theme": {
                                "color": "#3399cc"
                            },
                            "modal": {
                                "ondismiss": function () {
                                    payButton.disabled = false;
                                    payButton.innerHTML = `<span id="pay-button-text">Pay â‚¹${parseFloat(amount).toFixed(2)}</span><i class="fas fa-lock" style="margin-left: 8px;"></i>`;
                                }
                            }
                        };

                        const rzp1 = new Razorpay(options);
                        rzp1.open();

                    } catch (error) {
                        console.error('Payment Error:', error);
                        document.getElementById('error-message-text').textContent = error.message || 'Payment initiation failed';
                        errorModal.style.display = 'flex';
                        payButton.disabled = false;
                        payButton.innerHTML = `<span id="pay-button-text">Pay â‚¹${parseFloat(amount).toFixed(2)}</span><i class="fas fa-lock" style="margin-left: 8px;"></i>`;
                    }
                });
            }

            // Set up modal buttons
            if (successOkButton) {
                successOkButton.addEventListener('click', () => {
                    successModal.style.display = 'none';
                    // Redirect to certificate with the registration ID
                    if (registrationId) {
                        window.location.href = `certificate.html?id=${registrationId}`;
                    } else {
                        alert("Registration ID missing, redirecting to home.");
                        window.location.href = 'index.html';
                    }
                });
            }

            if (errorOkButton) {
                errorOkButton.addEventListener('click', () => {
                    errorModal.style.display = 'none';
                });
            }
        }

        // Show the selected payment form
        function showPaymentForm(method) {
            // Hide all forms
            cardForm.classList.remove('active');
            upiForm.classList.remove('active');
            netbankingForm.classList.remove('active');
            walletForm.classList.remove('active');

            // Show selected form
            if (method === 'card') {
                cardForm.classList.add('active');
            } else if (method === 'upi') {
                upiForm.classList.add('active');
                payButton.disabled = true; // Disable until UPI is verified
            } else if (method === 'netbanking') {
                netbankingForm.classList.add('active');
                payButton.disabled = true; // Disable until bank is selected
            } else if (method === 'wallet') {
                walletForm.classList.add('active');
                payButton.disabled = true; // Disable until wallet is selected
            }
        }

        // Format card number with spaces
        function formatCardNumber(e) {
            let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            let formatted = '';

            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formatted += ' ';
                }
                formatted += value[i];
            }

            e.target.value = formatted.substring(0, 19); // Max 16 digits + 3 spaces
        }

        // Format expiry date
        function formatExpiryDate(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');

            if (value.length >= 2) {
                e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4);
            } else {
                e.target.value = value;
            }
        }

        // Validate card number
        function validateCardNumber() {
            const cardNumber = cardNumberInput.value.replace(/\s/g, '');

            if (cardNumber.length !== 16 || !/^\d+$/.test(cardNumber)) {
                showError(cardNumberInput, cardNumberError, 'Please enter a valid 16-digit card number');
                return false;
            } else {
                hideError(cardNumberInput, cardNumberError);
                return true;
            }
        }

        // Validate card name
        function validateCardName() {
            if (cardNameInput.value.trim().length < 3) {
                showError(cardNameInput, cardNameError, 'Please enter the name on your card');
                return false;
            } else {
                hideError(cardNameInput, cardNameError);
                return true;
            }
        }

        // Validate expiry date
        function validateExpiryDate() {
            const value = expiryInput.value;
            const regex = /^(0[1-9]|1[0-2])\/([0-9]{2})$/;

            if (!regex.test(value)) {
                showError(expiryInput, expiryError, 'Please enter a valid expiry date (MM/YY)');
                return false;
            }

            // Check if card is expired
            const [month, year] = value.split('/');
            const currentYear = new Date().getFullYear() % 100;
            const currentMonth = new Date().getMonth() + 1;

            if (parseInt(year) < currentYear ||
                (parseInt(year) === currentYear && parseInt(month) < currentMonth)) {
                showError(expiryInput, expiryError, 'This card has expired');
                return false;
            }

            hideError(expiryInput, expiryError);
            return true;
        }

        // Validate CVV
        function validateCVV() {
            const cvv = cvvInput.value;

            if (cvv.length < 3 || cvv.length > 4 || !/^\d+$/.test(cvv)) {
                showError(cvvInput, cvvError, 'Please enter a valid CVV (3 or 4 digits)');
                return false;
            } else {
                hideError(cvvInput, cvvError);
                return true;
            }
        }

        // Validate UPI ID
        function isValidUpiId(upiId) {
            const regex = /^[a-zA-Z0-9.\-_]{2,49}@[a-zA-Z]{2,}$/;
            return regex.test(upiId);
        }

        // Show error for an input
        function showError(inputElement, errorElement, message) {
            inputElement.classList.add('input-error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // Hide error for an input
        function hideError(inputElement, errorElement) {
            inputElement.classList.remove('input-error');
            errorElement.style.display = 'none';
        }

        // Process payment
        function processPayment() {
            // Validate based on selected method
            let isValid = true;

            if (selectedMethod === 'card') {
                isValid = validateCardNumber() && validateCardName() && validateExpiryDate() && validateCVV();
            } else if (selectedMethod === 'upi') {
                if (!upiVerified) {
                    showError(upiIdInput, upiError, 'Please verify your UPI ID first');
                    isValid = false;
                }
            } else if (selectedMethod === 'netbanking') {
                if (!selectedBank) {
                    alert('Please select your bank');
                    isValid = false;
                }
            } else if (selectedMethod === 'wallet') {
                if (!selectedWallet) {
                    alert('Please select your wallet');
                    isValid = false;
                }
            }

            if (!isValid) {
                return;
            }

            // Disable pay button and show processing state
            payButton.disabled = true;
            payButtonText.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

            // Simulate payment processing
            setTimeout(() => {
                // Simulate 80% chance of success
                const isSuccess = Math.random() > 0.2;

                if (isSuccess) {
                    showSuccessModal();
                } else {
                    showErrorModal('Payment declined by your bank. Please try again with a different card or payment method.');
                }

                // Reset pay button
                payButton.disabled = false;
                payButtonText.textContent = `Pay â‚¹1,627.82`;
            }, 2000);
        }


        // ========== REDIRECT TO CERTIFICATE PAGE WITH ALERT ==========
        // Add this script to your page where the "OK" button exists

        document.addEventListener('DOMContentLoaded', function () {
            // Get the OK button by ID
            const okButton = document.getElementById('success-ok');

            // Check if button exists
            if (okButton) {
                // Add click event listener
                okButton.addEventListener('click', function () {
                    // Show alert message
                    alert('âœ… Your marriage certificate is ready! Redirecting to download page...');

                    // Redirect to certificate page
                    // METHOD 1: Simple redirect
                    window.location.href = 'certificate.html';

                    // METHOD 2: Redirect with parameter (if you want to pass application ID)
                    // const applicationId = 'MRG-' + Date.now().toString().slice(-8);
                    // window.location.href = `certificate.html?app_id=${applicationId}`;

                    // METHOD 3: Redirect with delay (if you want to show alert first)
                    // setTimeout(function() {
                    //     window.location.href = 'certificate.html';
                    // }, 500);
                });
            }
        });

        // ========== ALTERNATIVE: DIRECT FUNCTION ==========
        // You can also call this function directly from the button onclick
        function redirectToCertificate() {
            // Show alert message
            alert('ðŸŽ‰ Congratulations! Your marriage certificate has been generated successfully.');

            // Redirect to certificate page
            window.location.href = 'certificate.html';
        }

        // ========== WITH APPLICATION DATA ==========
        // If you want to pass application data to certificate page
        function redirectWithCertificateData() {
            // Collect certificate data
            const certificateData = {
                applicationId: 'TNMAR-' + Date.now().toString().slice(-8),
                brideName: document.getElementById('bride-name')?.value || 'Bride Name',
                groomName: document.getElementById('groom-name')?.value || 'Groom Name',
                marriageDate: document.getElementById('marriage-date')?.value || '2024-01-15',
                registrationNumber: 'REG/' + new Date().getFullYear() + '/' + Math.floor(Math.random() * 10000).toString().padStart(4, '0'),
                issueDate: new Date().toLocaleDateString('en-IN')
            };

            // Store in sessionStorage for certificate page to access
            sessionStorage.setItem('certificateData', JSON.stringify(certificateData));

            // Show alert
            alert('âœ… Certificate generated! Application ID: ' + certificateData.applicationId + '\nRedirecting to certificate page...');

            // Redirect to certificate page
            window.location.href = 'certificate.html';
        }

        // ========== FOR MODAL/POPUP BUTTON ==========
        // Use this if your OK button is inside a modal
        function closeModalAndRedirect() {
            // Show alert
            alert('ðŸ“„ Your marriage certificate is ready for download.');

            // Close modal (if you have modal close function)
            if (typeof closeModal === 'function') {
                closeModal();
            }

            // Hide modal manually (if using Bootstrap)
            const modalElement = document.getElementById('successModal');
            if (modalElement) {
                modalElement.style.display = 'none';
                modalElement.classList.remove('show');
                document.body.classList.remove('modal-open');
                const backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) backdrop.remove();
            }

            // Redirect to certificate page
            window.location.href = 'certificate.html';
        }

        // ========== WITH PRINT OPTION ==========
        function redirectAndPrintCertificate() {
            // Show alert with option
            const userChoice = confirm('Your certificate is ready!\n\nClick OK to view and print certificate.\nClick Cancel to go to dashboard.');

            if (userChoice) {
                alert('Opening certificate page...');
                window.location.href = 'certificate.html?action=print';
            } else {
                window.location.href = 'dashboard.html';
            }
        }

        // ========== FOR MULTI-STEP PROCESS ==========
        function completeProcessAndShowCertificate() {
            // Step 1: Show processing message
            const button = document.getElementById('success-ok');
            const originalText = button.innerHTML;
            button.innerHTML = 'â³ Generating certificate...';
            button.disabled = true;

            // Step 2: Show alert after short delay
            setTimeout(function () {
                alert('âœ¨ Your marriage registration is complete!\nðŸ“„ Certificate is being generated...');
            }, 500);

            // Step 3: Redirect to certificate page
            setTimeout(function () {
                window.location.href = 'certificate.html';
            }, 1500);
        }

        // ========== WITH ANIMATION AND FEEDBACK ==========
        async function redirectWithFeedback() {
            // Show custom alert (if you have SweetAlert)
            if (typeof Swal !== 'undefined') {
                await Swal.fire({
                    icon: 'success',
                    title: 'Registration Complete!',
                    text: 'Your marriage certificate is ready.',
                    timer: 2000,
                    showConfirmButton: true,
                    confirmButtonText: 'View Certificate'
                });
                window.location.href = 'certificate.html';
            } else {
                // Fallback to default alert
                alert('âœ… Success! Your marriage certificate is ready.');
                window.location.href = 'certificate.html';
            }
        }
        // ========== AUTO-REDIRECT AFTER ALERT (if needed) ==========
        function showAlertAndRedirect(message, url, delay = 1000) {
            alert(message);
            setTimeout(function () {
                window.location.href = url;
            }, delay);
        }

        // Usage: showAlertAndRedirect('Certificate ready!', 'certificate.html', 1500);

        // Show success modal
        function showSuccessModal() {
            successModal.style.display = 'flex';
        }

        // Show error modal with custom message
        function showErrorModal(message) {
            document.getElementById('error-message-text').textContent = message;
            errorModal.style.display = 'flex';
        }

        // Reset the form after successful payment
        function resetForm() {
            // Reset card form
            cardNumberInput.value = '';
            cardNameInput.value = '';
            expiryInput.value = '';
            cvvInput.value = '';

            // Reset UPI form
            upiIdInput.value = '';
            verifyUpiButton.textContent = 'Verify';
            verifyUpiButton.style.backgroundColor = '#10b981';
            upiVerified = false;

            // Reset selections
            selectedBank = null;
            selectedWallet = null;

            // Reset any active selections
            document.querySelectorAll('.bank-item, .wallet-item').forEach(item => {
                item.style.borderColor = '#e2e8f0';
                item.style.backgroundColor = 'white';
            });

            // Reset to card payment method
            paymentMethods.forEach(m => m.classList.remove('active'));
            paymentMethods[0].classList.add('active');
            showPaymentForm('card');
        }

        // Initialize the payment gateway when page loads
        document.addEventListener('DOMContentLoaded', initPaymentGateway);
    </script>
</body>

</html>